!function e(t,o,n){function r(c,i){if(!o[c]){if(!t[c]){var l="function"==typeof require&&require;if(!i&&l)return l(c,!0);if(a)return a(c,!0);throw new Error("Cannot find module '"+c+"'")}var s=o[c]={exports:{}};t[c][0].call(s.exports,function(e){var o=t[c][1][e];return r(o?o:e)},s,s.exports,e,t,o,n)}return o[c].exports}for(var a="function"==typeof require&&require,c=0;c<n.length;c++)r(n[c]);return r}({1:[function(e){var t,o,n,r,a;t=angular.module("mampfApp",["onsen.directives","ngTouch","ngMd5","ui.map","angularLocalStorage","ui.validate"]),o={config:e("./config/static.coffee"),constants:e("./config/constants.coffee"),_:window._},t.constant(o),a={device:e("./factories/device.coffee"),cordovaReady:e("./factories/cordova_ready.coffee"),contactChooser:e("./factories/contact_chooser.coffee"),geoLocation:e("./factories/geolocation.coffee"),sharedData:e("./factories/shared_data.coffee"),server:e("./factories/server.coffee")},t.factory(a),n={ContactListCtrl:e("./controllers/contacts/contact_list_ctrl.coffee"),ContactDetailsCtrl:e("./controllers/contacts/contact_details_ctrl.coffee"),LunchRequestCtrl:e("./controllers/lunch/lunch_request_ctrl.coffee"),LunchResponseCtrl:e("./controllers/lunch/lunch_response_ctrl.coffee"),TimeslotCtrl:e("./controllers/lunch/timeslot_ctrl.coffee"),ChooseLocationCtrl:e("./controllers/lunch/choose_location_ctrl.coffee"),ChooseContactCtrl:e("./controllers/lunch/choose_contact_ctrl.coffee"),ProfileCtrl:e("./controllers/profile/profile_ctrl.coffee"),AddLocationCtrl:e("./controllers/profile/add_location_ctrl.coffee"),ShowLocationsCtrl:e("./controllers/profile/show_locations_ctrl.coffee"),LocationDetailCtrl:e("./controllers/profile/location_detail_ctrl.coffee")},t.controller(n),r={sharedValidate:e("./directives/shared_validate.coffee")},t.directive(r),t.config(["$httpProvider",function(e){return e.defaults.useXDomain=!0,delete e.defaults.headers.common["X-Requested-With"]}]),window.onGoogleReady=function(){return console.log("google rdy"),angular.bootstrap(document.getElementsByTagName("body"),["mampfApp"])}},{"./config/constants.coffee":2,"./config/static.coffee":3,"./controllers/contacts/contact_details_ctrl.coffee":4,"./controllers/contacts/contact_list_ctrl.coffee":5,"./controllers/lunch/choose_contact_ctrl.coffee":6,"./controllers/lunch/choose_location_ctrl.coffee":7,"./controllers/lunch/lunch_request_ctrl.coffee":8,"./controllers/lunch/lunch_response_ctrl.coffee":9,"./controllers/lunch/timeslot_ctrl.coffee":10,"./controllers/profile/add_location_ctrl.coffee":11,"./controllers/profile/location_detail_ctrl.coffee":12,"./controllers/profile/profile_ctrl.coffee":13,"./controllers/profile/show_locations_ctrl.coffee":14,"./directives/shared_validate.coffee":15,"./factories/contact_chooser.coffee":16,"./factories/cordova_ready.coffee":17,"./factories/device.coffee":18,"./factories/geolocation.coffee":19,"./factories/server.coffee":20,"./factories/shared_data.coffee":21}],2:[function(e,t){var o;o={USE_GPS_LOCATION:0,USE_PREDEFINED_LOCATION:1,LOCATION_NOT_SET:2},t.exports=o},{}],3:[function(e,t){var o;o={server:"http://141.83.68.32/mampf/",dummyContacts:[{displayName:"dummy",selected:!1,telephone:"+4917629322211",telephoneHash:"f828ffdfcd8b508cd0a9d16771a55745"},{displayName:"dummy2",selected:!1,telephone:"+4917629322212",telephoneHash:"2180878ef6bb945692cd66a0c053faf0"}],dummyLocations:[{locationName:"Footown",selected:!1,latitude:-6,longitude:-7},{locationName:"Bartown",selected:!1,latitude:-5,longitude:-8}],defaultTimeslots:[{startTime:"12:00",endTime:"14:00"}],dummyUser:{telephone:"01522905094913",telephoneHash:"d949dd7b976c60f70f6492ee673d6768"}},t.exports=o},{}],4:[function(e,t){var o;o=["$scope","config","storage","sharedData",function(){}],t.exports=o},{}],5:[function(e,t){var o;o=["$scope","contactChooser","sharedData","storage","config","md5",function(e,t,o,n,r,a){return n.bind(e,"contacts",{defaultValue:r.dummyContacts}),e.toggleContact=function(t){return t.selected=!t.selected,o.contacts=e.contacts},e.contactAdd=function(){return t.get().then(function(t){var n,r;return console.log("contact",t,t.phoneNumbers.value),t.phoneNumbers&&(n=t.phoneNumbers[1].value).trim()&&!n.test(/^\+49\s*/)&&n.test(/^0\s*/)&&(n=n.replace(/0/,"+49"),r=a.createHash(""+n)),t={displayName:t.displayName,telephone:n,telephoneHash:r,selected:!1},0===e.contacts.filter(function(e){return e.telephone===n}).length&&(e.contacts.push(t),o.contacts.length)?o.contacts.push(t):void 0},function(e){return console.log("lol fehler",e)})}}],t.exports=o},{}],6:[function(e,t){var o;o=["$scope","config","storage","sharedData",function(e,t,o,n){var r,a,c,i;if(e.hideNoContactElement=!1,n.contacts.length)e.contactsForChoose=n.contacts;else if(o.bind(e,"contacts",{defaultValue:t.dummyContacts}),e.contacts){for(e.contactsForChoose=angular.copy(e.contacts),i=e.contactsForChoose,a=0,c=i.length;c>a;a++)r=i[a],r.selected=!1;e.hideNoContactElement=!0}return e.toggleContact=function(t){return t.selected=!t.selected,n.contacts=e.contactsForChoose}}],t.exports=o},{}],7:[function(e,t){var o;o=["$scope","config","storage","sharedData",function(e,t,o,n){var r,a,c,i;if(e.positionLocation=n.positionLocation||!1,n.locations.length)e.locationsForChoose=n.locations;else if(e.locations=o.get("locations"),e.locations)for(e.locationsForChoose=angular.copy(e.locations),i=e.locationsForChoose,a=0,c=i.length;c>a;a++)r=i[a],r.selected=!1;return e.toggleLocation=function(t){var o,r,a,c;for(e.positionLocation=!1,c=e.locationsForChoose,r=0,a=c.length;a>r;r++)o=c[r],o.selected=!1;return t.selected=!t.selected,n.locations=e.locationsForChoose},e.setLocationPosition=function(){var t,o,r,a;if(e.locationsForChoose)for(a=e.locationsForChoose,o=0,r=a.length;r>o;o++)t=a[o],t.selected=!1;return e.positionLocation=!e.positionLocation,n.positionLocation=e.positionLocation}}],t.exports=o},{}],8:[function(e,t){var o;o=["$scope","sharedData","storage","config","constants","geoLocation","server","$q","$interval","$rootScope",function(e,t,o,n,r,a,c,i){var l,s;return o.bind(e,"user"),e.getCount=function(){return t.contacts.filter(function(e){return e.selected}).length},e.requestNotReady=function(){return 0===e.getCount()||!e.isUserPropertiesDefined()||null===e.getSelectedLocationName()||"undefined"==typeof t.timeslots},e.isUserPropertiesDefined=function(){return"undefined"!=typeof e.user&&"undefined"!=typeof e.user.telephone&&"undefined"!=typeof e.user.telephoneHash},e.getSelectedLocationName=function(){var e,t,o;switch(o=s(),t=o[0],e=o[1],t){case r.USE_PREDEFINED_LOCATION:return e.length?e[0].locationName:null;case r.USE_GPS_LOCATION:return"Aktuelle Position ermitteln";case r.LOCATION_NOT_SET:return null;default:return null}},e.doRequest=function(){var o,n;return o=t.contacts.filter(function(e){return e.selected}).map(function(e){return e.telephoneHash}),n=e.user.telephoneHash,l().then(function(e){var r;return r={identity:n,invitees:o,currentPosition:e,timeSlots:t.timeslots},c.create({data:JSON.stringify(r,null,"  ")}).then(function(e){return console.log("we have a response",e)},function(e){return console.log("fehler",e)})},function(){return console.log("oops error while retrieving coordinates",coords)})},s=function(){var e;return e=t.locations.filter(function(e){return e.selected}),e.length?[r.USE_PREDEFINED_LOCATION,e]:t.positionLocation?[r.USE_GPS_LOCATION,null]:[r.LOCATION_NOT_SET,null]},l=function(){var e,t,o,n;switch(e=i.defer(),n=s(),o=n[0],t=n[1],o){case r.USE_PREDEFINED_LOCATION:t.length?e.resolve({longitude:t[0].longitude,latitude:t[0].latitude}):e.reject();break;case r.USE_GPS_LOCATION:a.getPosition().then(function(t){return e.resolve({latitude:t.coords.latitude,longitude:t.coords.longitude})},function(){return e.reject()});break;case r.LOCATION_NOT_SET:e.reject();break;default:e.reject()}return e.promise}}],t.exports=o},{}],9:[function(){},{}],10:[function(e,t){var o;o=["$scope","config","storage","sharedData",function(e,t,o,n){var r;return o.bind(e,"timeslots",{defaultValue:t.defaultTimeslots}),e.validateTime=function(e,t){return t>=e},e.setDateTime=function(t){var o,n;return o=new Date,e.timeslots[t].startTime=o.toLocaleTimeString(navigator.language,{hour:"2-digit",minute:"2-digit"}),n=o.getTime()+72e5,e.timeslots[t].endTime=new Date(n).toLocaleTimeString(navigator.language,{hour:"2-digit",minute:"2-digit"})},e.setDateTime(0),e.addTimeSlot=function(){var t;return t=e.timeslots.length,e.timeslots.push({startTime:"",endTime:""}),e.setDateTime(t)},e.removeTimeSlot=function(t){return e.timeslots.splice(t,1)},r=function(){var t,o,r;return r=new Date,t=""+r.getFullYear()+"-"+(r.getMonth()+1)+"-"+r.getDate(),o=angular.copy(e.timeslots),o=o.map(function(e){return{startTime:new Date(Date.parse(""+t+", "+e.startTime)).toISOString(),endTime:new Date(Date.parse(""+t+", "+e.endTime)).toISOString()}}),n.timeslots=o},r(),e.saveTimeSlots=function(){return r()}}],t.exports=o},{}],11:[function(e,t){var o;o=["$scope","config","storage","sharedData","geoLocation",function(e,t,o,n,r){return o.bind(e,"locations",{defaultValue:t.dummyLocations}),e.locationModel="Ort "+(e.locations.length+1),e.mapOptions={center:new google.maps.LatLng(53.8353,10.6349),zoom:15,mapTypeId:google.maps.MapTypeId.ROADMAP},e.addNewLocation=function(){var t,o,r;return t=e.marker.getPosition().lat(),o=e.marker.getPosition().lng(),r={locationName:e.locationModel,selected:!1,latitude:t,longitude:o},n.locations.length&&n.locations.push(r),e.locations.push(r)},e.mapClick=function(t,o){return e.setMarkerPosition(o[0].latLng.lat(),o[0].latLng.lng())},e.setMarkerPosition=function(t,o){return e.marker.setPosition(new google.maps.LatLng(t,o))},e.refreshPosition=function(){return r.getPosition().then(function(t){var o;return e.position=t,o={lat:t.coords.latitude,lng:t.coords.longitude},e.mampfMap&&e.mampfMap.setCenter(o),e.marker?e.marker.setPosition(o):e.marker=new google.maps.Marker({position:o,map:e.mampfMap})},function(e){return console.log("lol noch ein geo fehler",e)})},e.refreshPosition()}],t.exports=o},{}],12:[function(e,t){var o;o=["$scope","config","sharedData","$timeout","storage",function(e,t,o,n,r){return r.bind(e,"locations",{defaultValue:t.dummyLocations}),e.location=o.location,e.modalMapOptions={center:new google.maps.LatLng(e.location.latitude,e.location.longitude),zoom:15,mapTypeId:google.maps.MapTypeId.ROADMAP},e.mapClick=function(t,o){var n,r,a;return a=[o[0].latLng.lat(),o[0].latLng.lng()],n=a[0],r=a[1],e.marker.setPosition(new google.maps.LatLng(n,r)),e.location.longitude=r,e.location.latitude=n},e.refreshPosition=function(){var t;if(e.modalMampfMap)return t={lat:e.location.latitude,lng:e.location.longitude},e.modalMampfMap.setCenter(t),e.marker?e.marker.setPosition(t):e.marker=new google.maps.Marker({position:t,map:e.modalMampfMap})},n(function(){return e.refreshPosition()},500)}],t.exports=o},{}],13:[function(e,t){var o;o=["$scope","md5","config","_","storage","sharedData",function(e,t,o,n,r,a){return r.bind(e,"user",{defaultValue:o.dummyUser}),a.user=e.user,e.$watch("user.telephone",n.debounce(function(o){return o?e.$apply(function(){return e.user.telephone=o.replace(" ",""),e.user.telephoneHash=t.createHash(""+e.user.telephone),a.user=e.user}):void 0},500))}],t.exports=o},{}],14:[function(e,t){var o;o=["$scope","config","storage","sharedData",function(e,t,o,n){return o.bind(e,"locations",{defaultValue:t.dummyLocations}),e.pushPage=function(e){return n.location=e,ons.navigator.pushPage("partials/profile/locationDetail.html",{animation:"fade"})},e.deleteAllSelected=function(){var t,o,n,r,a;for(r=e.locations.filter(function(e){return e.selected}),a=[],o=0,n=r.length;n>o;o++)t=r[o],a.push(e.deleteLocation(t));return a},e.deleteLocation=function(t){return e.locations.splice(e.locations.indexof(t),1)}}],t.exports=o},{}],15:[function(e,t){var o;o=function(){return{restrict:"A",require:"ngModel",link:function(e,t,o,n){return console.log("it works"),e.$watch(o.sharedValidate,function(e){var t,r;return r=parseInt(n.$viewValue.replace(":","")),e=parseInt(e.replace(":","")),t=!0,"request.startTime"===o.ngModel?(t=e>=r,n.$setValidity("lessThan",t)):"request.endTime"===o.ngModel?(t=r>=e,n.$setValidity("greaterThan",t)):void 0}),e.$watch(o.ngModel,function(e){return console.log("value - model",e),console.log("ngModel",o.sharedValidate)})}}},t.exports=o},{}],16:[function(e,t){var o;o=["$window","$timeout","$q",function(e,t,o){var n;return n=function(){var e;return e=o.defer(),navigator.contacts.pickContact(function(t){return e.resolve(t)},function(t){return e.reject(t)}),e.promise},{get:n}}],t.exports=o},{}],17:[function(e,t){var o;o=["$q","$rootScope","$document",function(e,t,o){var n;return n=e.defer(),o.bind("deviceready",function(){return t.$apply(n.resolve)}),{ready:function(){return n.promise}}}],t.exports=o},{}],18:[function(e,t){var o;o=function(){var e,t,o,n,r;for(t={},r=["cordova","model","name","platform","uuid","version"],o=0,n=r.length;n>o;o++)e=r[o],t[e]="undefined"!=typeof device&&null!==device?device[e]:null;return t},t.exports=o},{}],19:[function(e,t){var o;o=["$q",function(e){var t;return t=function(){var t;return t=e.defer(),navigator.geolocation.getCurrentPosition(function(e){return t.resolve(e)},function(e){return t.reject(e)},{maximumAge:5e3,timeout:5e3,enableHighAccuracy:!0}),t.promise},{getPosition:t}}],t.exports=o},{}],20:[function(e,t){var o;o=["$http","config",function(e,t){var o;return o=function(o){return e.post(""+t.server,{withCredentials:!0,data:o.data})},{create:function(e){return o(angular.extend(e,{data:e.data,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, POST, PUT, DELETE, OPTIONS","Access-Control-Allow-Headers":"Content-Type, X-Requested-With"}}))},update:function(e){return o(angular.extend(e,{method:"PUT"}))},"delete":function(e){return o(angular.extend(e,{method:"DELETE"}))},get:function(e){return o(angular.extend(e,{method:"GET"}))},callbackError:function(){return console.log("yay error")},callbackDone:function(){return console.log("yay done")}}}],t.exports=o},{}],21:[function(e,t){var o;o=function(){return{contacts:[],locations:[]}},t.exports=o},{}]},{},[1]);