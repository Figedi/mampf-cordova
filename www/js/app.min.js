!function e(t,o,n){function r(a,s){if(!o[a]){if(!t[a]){var i="function"==typeof require&&require;if(!s&&i)return i(a,!0);if(c)return c(a,!0);throw new Error("Cannot find module '"+a+"'")}var l=o[a]={exports:{}};t[a][0].call(l.exports,function(e){var o=t[a][1][e];return r(o?o:e)},l,l.exports,e,t,o,n)}return o[a].exports}for(var c="function"==typeof require&&require,a=0;a<n.length;a++)r(n[a]);return r}({1:[function(e){var t,o,n,r;t=angular.module("mampfApp",["onsen.directives","ngMd5","ui.map","angularLocalStorage","ui.validate","ngTouch"]),o={config:e("./config/static.coffee"),constants:e("./config/constants.coffee"),_:window._,OAuth:window.OAuth},t.constant(o),r={device:e("./factories/device.coffee"),cordovaReady:e("./factories/cordova_ready.coffee"),contactChooser:e("./factories/contact_chooser.coffee"),geoLocation:e("./factories/geolocation.coffee"),sharedData:e("./factories/shared_data.coffee"),server:e("./factories/server.coffee"),googleContacts:e("./factories/google_contacts.coffee")},t.factory(r),n={ContactListCtrl:e("./controllers/contacts/contact_list_ctrl.coffee"),EditContactCtrl:e("./controllers/contacts/edit_contact_ctrl.coffee"),GoogleContactsCtrl:e("./controllers/contacts/google_contacts_ctrl.coffee"),AddNewContactCtrl:e("./controllers/contacts/add_new_contact_ctrl.coffee"),AddLocationCtrl:e("./controllers/locations/add_location_ctrl.coffee"),ShowLocationsCtrl:e("./controllers/locations/show_locations_ctrl.coffee"),LocationDetailCtrl:e("./controllers/locations/location_detail_ctrl.coffee"),LunchRequestCtrl:e("./controllers/lunch/lunch_request_ctrl.coffee"),LunchResponseCtrl:e("./controllers/lunch/lunch_response_ctrl.coffee"),TimeslotCtrl:e("./controllers/lunch/timeslot_ctrl.coffee"),ChooseLocationCtrl:e("./controllers/lunch/choose_location_ctrl.coffee"),ChooseContactCtrl:e("./controllers/lunch/choose_contact_ctrl.coffee"),ProfileCtrl:e("./controllers/profile/profile_ctrl.coffee")},t.controller(n),window.onGoogleReady=function(){return angular.bootstrap(document.getElementsByTagName("body"),["mampfApp"])}},{"./config/constants.coffee":2,"./config/static.coffee":3,"./controllers/contacts/add_new_contact_ctrl.coffee":4,"./controllers/contacts/contact_list_ctrl.coffee":5,"./controllers/contacts/edit_contact_ctrl.coffee":6,"./controllers/contacts/google_contacts_ctrl.coffee":7,"./controllers/locations/add_location_ctrl.coffee":8,"./controllers/locations/location_detail_ctrl.coffee":9,"./controllers/locations/show_locations_ctrl.coffee":10,"./controllers/lunch/choose_contact_ctrl.coffee":11,"./controllers/lunch/choose_location_ctrl.coffee":12,"./controllers/lunch/lunch_request_ctrl.coffee":13,"./controllers/lunch/lunch_response_ctrl.coffee":14,"./controllers/lunch/timeslot_ctrl.coffee":15,"./controllers/profile/profile_ctrl.coffee":16,"./factories/contact_chooser.coffee":17,"./factories/cordova_ready.coffee":18,"./factories/device.coffee":19,"./factories/geolocation.coffee":20,"./factories/google_contacts.coffee":21,"./factories/server.coffee":22,"./factories/shared_data.coffee":23}],2:[function(e,t){var o;o={USE_GPS_LOCATION:0,USE_PREDEFINED_LOCATION:1,LOCATION_NOT_SET:2,NO_ERROR:3,ERROR_BY_NO_MATCH:4,ERROR_BY_NO_SERVER_RESPONSE:5,ERROR_BY_RETRIEVING_POSITION:6},t.exports=o},{}],3:[function(e,t){var o;o={server:"http://141.83.68.32/mampf/",dummyContacts:[{displayName:"dummy",selected:!1,telephone:"+4917629322211",telephoneHash:"490a707488746155f9fe9e4074e54eff"},{displayName:"dummy2",selected:!1,telephone:"+4917629322212",telephoneHash:"1a88fc410f2cd3800e50e2227884f1a2"}],dummyLocations:[{locationName:"Footown",selected:!1,latitude:-6,longitude:-7},{locationName:"Bartown",selected:!1,latitude:-5,longitude:-8}],defaultTimeslots:[{startTime:"12:00",endTime:"14:00"}],dummyUser:{telephone:"01522905094913",telephoneHash:"d949dd7b976c60f70f6492ee673d6768"},provider:{type:"local"}},t.exports=o},{}],4:[function(e,t){var o;o=["$scope","sharedData","storage","config","md5",function(e,t,o,n,r){return o.bind(e,"contacts"),e.numberExists=function(){return e.contact?e.contacts.reduce(function(t,o){return t||o.telephone===e.contact.telephone},!1):!1},e.addNewContact=function(){var n;return t.contacts=[],e.contact.telephone=e.contact.telephone.replace(RegExp(" ","g"),""),n={displayName:e.contact.displayName,selected:!1,telephone:e.contact.telephone,telephoneHash:r.createHash(""+e.contact.telephone)},e.contacts.push(n),o.set("contacts",e.contacts)}}],t.exports=o},{}],5:[function(e,t){var o;o=["$scope","contactChooser","sharedData","storage","config","md5","_",function(e,t,o,n,r,c){return n.bind(e,"contacts",{defaultValue:r.dummyContacts}),e.toggleContact=function(t){return t.selected=!t.selected,o.contacts=e.contacts},e.deleteContact=function(t){return e.contacts.splice(t,1)},e.isSmartphone=function(){return navigator.userAgent.match(/(iPhone|iPod|iPad|Android|BlackBerry|IEMobile)/)},e.editContact=function(e,t){return o.contact=t,contactsNav.pushPage("partials/contacts/edit_contact.html",{animation:"fade"})},e.contactAdd=function(){var r;return r=n.get("provider"),e.isSmartphone()||(r="manual"),"local"===r?t.get().then(function(t){var n,r;return t.phoneNumbers.length&&(n=t.phoneNumbers[1].value).trim()&&!n.test(/^\+49\s*/)&&n.test(/^0\s*/)&&(n=n.replace(/0/,"+49"),r=c.createHash(""+n)),t={displayName:t.displayName,telephone:n,telephoneHash:r,selected:!1},0===e.contacts.filter(function(e){return e.telephone===n}).length&&(e.contacts.push(t),o.contacts.length)?o.contacts.push(t):void 0},function(e){return console.log("lol fehler",e)}):"contacts"===r?contactsNav.pushPage("partials/contacts/google_contacts.html"):"manual"===r&&contactsNav.pushPage("partials/contacts/add_new_contact.html"),contactsNav.on("prepop",function(){return e.contacts=n.get("contacts")})}}],t.exports=o},{}],6:[function(e,t){var o;o=["$scope","storage","sharedData","md5",function(e,t,o,n){return e.contact=o.contact,e.contacts=t.get("contacts").filter(function(e){return e.telephone!==o.contact.telephone}),e.$watch("contact.telephone",_.debounce(function(t){return t?e.$apply(function(){return e.contact.telephone=t.replace(RegExp(" ","g"),""),e.contact.telephoneHash=n.createHash(""+e.contact.telephone)}):void 0},1e3)),e.numberExists=function(){return e.contact?e.contacts.reduce(function(t,o){return t||o.telephone===e.contact.telephone},!1):!1}}],t.exports=o},{}],7:[function(e,t){var o;o=["$scope","sharedData","storage","config","googleContacts","_",function(e,t,n,r,c){var a;return e.googleContacts=[],a=n.get("contacts"),e.refreshContacts=function(){return c.getAll().then(function(t){return e.googleContacts=t})},e.refreshContacts(),e.toggleContact=function(t){var r,c;return t.selected=!t.selected,o=angular.copy(a),c=e.googleContacts.filter(function(e){return e.selected}),r=o.concat(c),n.set("contacts",r)}}],t.exports=o},{}],8:[function(e,t){var o;o=["$scope","config","storage","sharedData","geoLocation",function(e,t,o,n,r){return o.bind(e,"locations",{defaultValue:t.dummyLocations}),e.locationModel="Ort "+(e.locations.length+1),e.mapOptions={center:new google.maps.LatLng(53.8353,10.6349),zoom:15,mapTypeId:google.maps.MapTypeId.ROADMAP},e.markerExistent=function(){return null!=e.marker},e.addNewLocation=function(){var t,n,r;return null==e.marker?!1:(t=e.marker.getPosition().lat(),n=e.marker.getPosition().lng(),r={locationName:e.locationModel,selected:!1,latitude:t,longitude:n},console.log("before locations",e.locations,o.get("locations")),e.locations.push(r),o.set("locations",e.locations),console.log("after locations",e.locations,o.get("locations")),!0)},e.mapClick=function(t,o){return e.setMarkerPosition(o[0].latLng.lat(),o[0].latLng.lng())},e.setMarkerPosition=function(t,o){return e.marker.setPosition(new google.maps.LatLng(t,o))},e.refreshPosition=function(){return r.getPosition().then(function(t){var o;return e.position=t,o={lat:t.coords.latitude,lng:t.coords.longitude},e.mampfMap&&e.mampfMap.setCenter(o),e.marker?e.marker.setPosition(o):e.marker=new google.maps.Marker({position:o,map:e.mampfMap})},function(e){return console.log("lol noch ein geo fehler",e)})},e.refreshPosition()}],t.exports=o},{}],9:[function(e,t){var o;o=["$scope","config","sharedData","$timeout","storage",function(e,t,o,n,r){return r.bind(e,"locations",{defaultValue:t.dummyLocations}),e.location=o.location,e.modalMapOptions={center:new google.maps.LatLng(e.location.latitude,e.location.longitude),zoom:15,mapTypeId:google.maps.MapTypeId.ROADMAP},e.mapClick=function(t,o){var n,r,c;return c=[o[0].latLng.lat(),o[0].latLng.lng()],n=c[0],r=c[1],e.marker.setPosition(new google.maps.LatLng(n,r)),e.location.longitude=r,e.location.latitude=n},e.refreshPosition=function(){var t;if(e.modalMampfMap)return t={lat:e.location.latitude,lng:e.location.longitude},e.modalMampfMap.setCenter(t),e.marker?e.marker.setPosition(t):e.marker=new google.maps.Marker({position:t,map:e.modalMampfMap})},n(function(){return e.refreshPosition()},500)}],t.exports=o},{}],10:[function(e,t){var o;o=["$scope","config","storage","sharedData",function(e,t,o,n){return o.bind(e,"locations",{defaultValue:t.dummyLocations}),e.showActions=!1,e.editLocation=function(e){return n.location=e,ons.navigator.pushPage("partials/locations/locationDetail.html",{animation:"fade"})},e.deleteLocation=function(t){return e.locations.splice(t,1)},locationsNav.on("prepop",function(){return e.locations=o.get("locations")})}],t.exports=o},{}],11:[function(e,t){var o;o=["$scope","config","storage","sharedData",function(e,t,o,n){var r,c,a,s;if(n.contacts.length)e.contactsForChoose=n.contacts;else if(o.bind(e,"contacts",{defaultValue:t.dummyContacts}),e.contacts.length)for(e.contactsForChoose=angular.copy(e.contacts),s=e.contactsForChoose,c=0,a=s.length;a>c;c++)r=s[c],r.selected=!1;return e.toggleContact=function(t){return t.selected=!t.selected,n.contacts=e.contactsForChoose}}],t.exports=o},{}],12:[function(e,t){var o;o=["$scope","config","storage","sharedData",function(e,t,o,n){var r,c,a,s;if(e.positionLocation=n.positionLocation||!1,n.locations.length)e.locationsForChoose=n.locations;else if(o.bind(e,"locations",{defaultValue:t.dummyLocations}),e.locations)for(console.log("it works"),e.locationsForChoose=angular.copy(e.locations),s=e.locationsForChoose,c=0,a=s.length;a>c;c++)r=s[c],r.selected=!1;return e.toggleLocation=function(t){var o,r,c,a;for(e.positionLocation=!1,a=e.locationsForChoose,r=0,c=a.length;c>r;r++)o=a[r],o.selected=!1;return t.selected=!t.selected,n.locations=e.locationsForChoose},e.setLocationPosition=function(){var t,o,r,c;if(e.locationsForChoose)for(c=e.locationsForChoose,o=0,r=c.length;r>o;o++)t=c[o],t.selected=!1;return e.positionLocation=!e.positionLocation,n.positionLocation=e.positionLocation}}],t.exports=o},{}],13:[function(e,t){var o;o=["server","$scope","sharedData","storage","config","constants","geoLocation","$q",function(e,t,o,n,r,c,a,s){var i,l,u;return n.bind(t,"user"),n.bind(t,"timeslots"),t.requestSent=!1,t.getCount=function(){return o.contacts.filter(function(e){return e.selected}).length},t.requestNotReady=function(){return 0===t.getCount()||!t.isUserPropertiesDefined()||null===t.getSelectedLocationName()||"undefined"==typeof o.timeslots},t.openModal=function(e){switch(e){case c.ERROR_BY_NO_MATCH:t.failureReason="Keine übereinstimmende Anfrage!";break;case c.ERROR_BY_NO_SERVER_RESPONSE:t.failureReason="Server antwortet nicht!";break;case c.ERROR_BY_RETRIEVING_POSITION:t.failureReason="Aktuelle Position nicht ermittelbar!";break;default:t.failureReason="Unbekannter Fehler"}return failureModal.show()},t.isUserPropertiesDefined=function(){var e;return null!=(null!=(e=t.user)?e.telephone:void 0)&&null!=t.user.telephoneHash},t.getSelectedLocationName=function(){var e,t,o;switch(o=u(),t=o[0],e=o[1],t){case c.USE_PREDEFINED_LOCATION:return e.length?e[0].locationName:null;case c.USE_GPS_LOCATION:return"Aktuelle Position ermitteln";case c.LOCATION_NOT_SET:return null;default:return null}},t.getSelectedTimes=function(){var e,n;return null!=o.timeslots?o.timeslots.length:(null!=(e=t.timeslots)?e.length:void 0)?null!=(n=t.timeslots)?n.length:void 0:"Keine"},i=function(e){var t;return t="partials/lunch/"+e,o.location=location,ons.navigator.pushPage(t,{animation:"slide"})},t.doRequest=function(){var n,r;return t.requestSent=!0,n=o.contacts.filter(function(e){return e.selected}).map(function(e){return e.telephoneHash}),r=t.user.telephoneHash,l().then(function(a){var s;return s={identity:r,invitees:n,currentPosition:a,timeslots:o.timeslots},e.send(s).then(function(e){return 0===e.data.subjects.length?(o.responseErrorId=c.ERROR_BY_NO_MATCH,t.openModal(c.ERROR_BY_NO_MATCH)):(o.responseData=angular.copy(e.data),console.log("sharedData is",o.responseData),o.responseErrorId=c.NO_ERROR,i("showResultsSuccessPage.html")),t.requestSent=!1},function(e){return o.responseErrorId=c.ERROR_BY_NO_SERVER_RESPONSE,o.responseError=angular.copy(e),t.openModal(c.ERROR_BY_NO_SERVER_RESPONSE),t.requestSent=!1})},function(e){return o.responseErrorId=c.ERROR_BY_RETRIEVING_POSITION,o.responseError=angular.copy(e),t.openModal(c.ERROR_BY_RETRIEVING_POSITION),t.requestSent=!1})},u=function(){var e;return e=o.locations.filter(function(e){return e.selected}),e.length?[c.USE_PREDEFINED_LOCATION,e]:o.positionLocation?[c.USE_GPS_LOCATION,null]:[c.LOCATION_NOT_SET,null]},l=function(){var e,t,o,n;switch(e=s.defer(),n=u(),o=n[0],t=n[1],o){case c.USE_PREDEFINED_LOCATION:t.length?e.resolve({longitude:t[0].longitude,latitude:t[0].latitude}):e.reject();break;case c.USE_GPS_LOCATION:a.getPosition().then(function(t){return e.resolve({latitude:t.coords.latitude,longitude:t.coords.longitude})},function(){return e.reject()});break;case c.LOCATION_NOT_SET:e.reject();break;default:e.reject()}return e.promise}}],t.exports=o},{}],14:[function(e,t){var o,n=[].indexOf||function(e){for(var t=0,o=this.length;o>t;t++)if(t in this&&this[t]===e)return t;return-1};o=["$scope","sharedData","config","constants",function(e,t,o,r){return e.selectedContacts=[],e.setTitle=function(){switch(t.responseErrorId){case r.NO_ERROR:return"Erfolgreiche Suche";default:return"Fehlerbehaftete Suche"}},e.setContacts=function(){return t.responseErrorId===r.NO_ERROR?e.selectedContacts=t.contacts.filter(function(e){var o;return o=e.telephoneHash,n.call(t.responseData.subjects,o)>=0}):void 0},e.setContacts(),e.getEnd=function(){var e;return e=new Date(t.responseData.timeslot.endTime),e.toLocaleTimeString("de",{hour:"2-digit",minute:"2-digit"})},e.getStart=function(){var e;return e=new Date(t.responseData.timeslot.startTime),e.toLocaleTimeString("de",{hour:"2-digit",minute:"2-digit"})}}],t.exports=o},{}],15:[function(e,t){var o,n;o=["de",{hour:"2-digit",minute:"2-digit"}],n=["$scope","config","storage","sharedData",function(e,t,n,r){var c;return n.bind(e,"timeslots",{defaultValue:t.defaultTimeslots}),e.validateTime=function(e,t){return parseInt(e.replace(":",""))<=parseInt(t.replace(":",""))},e.setDateTime=function(t){var n,r,c;return n=new Date,e.timeslots[t].startTime=n.toLocaleTimeString.apply(n,o),r=n.getTime()+72e5,e.timeslots[t].endTime=(c=new Date(r)).toLocaleTimeString.apply(c,o)},e.setDateTime(0),e.addTimeSlot=function(){var t;return t=e.timeslots.length,e.timeslots.push({startTime:"",endTime:""}),e.setDateTime(t)},e.removeTimeSlot=function(t){return e.timeslots.splice(t,1),c()},c=function(){var t,o,n;return n=new Date,t=""+n.getFullYear()+"-"+(n.getMonth()+1)+"-"+n.getDate(),o=angular.copy(e.timeslots),o=o.map(function(e){return{startTime:new Date(Date.parse(""+t+", "+e.startTime)).toISOString(),endTime:new Date(Date.parse(""+t+", "+e.endTime)).toISOString()}}),r.timeslots=o},c(),e.saveTimeSlots=c}],t.exports=n},{}],16:[function(e,t){var o;o=["$scope","md5","config","_","storage","sharedData",function(e,t,o,n,r,c){return r.bind(e,"user",{defaultValue:o.dummyUser}),r.bind(e,"provider",{defaultValue:o.provider.type}),c.user=e.user,e.$watch("user.telephone",n.debounce(function(o){return o?e.$apply(function(){return e.user.telephone=o.replace(RegExp(" ","g"),""),e.user.telephoneHash=t.createHash(""+e.user.telephone),c.user=e.user}):void 0},1e3)),e.setProvider=function(t){return e.provider=t}}],t.exports=o},{}],17:[function(e,t){var o;o=["$q",function(e){var t;return t=function(){var t;return t=e.defer(),navigator.contacts.pickContact(function(e){return t.resolve(e)},function(e){return t.reject(e)}),t.promise},{get:t}}],t.exports=o},{}],18:[function(e,t){var o;o=["$q","$rootScope","$document",function(e,t,o){var n;return n=e.defer(),o.bind("deviceready",function(){return t.$apply(n.resolve)}),{ready:function(){return n.promise}}}],t.exports=o},{}],19:[function(e,t){var o;o=function(){var e,t,o,n,r;for(t={},r=["cordova","model","name","platform","uuid","version"],o=0,n=r.length;n>o;o++)e=r[o],t[e]="undefined"!=typeof device&&null!==device?device[e]:null;return t},t.exports=o},{}],20:[function(e,t){var o;o=["$q",function(e){var t;return t=function(){var t;return t=e.defer(),navigator.geolocation.getCurrentPosition(function(e){return t.resolve(e)},function(e){return t.reject(e)},{maximumAge:5e3,timeout:5e3,enableHighAccuracy:!0}),t.promise},{getPosition:t}}],t.exports=o},{}],21:[function(e,t){var o;o=["$q","$http","$window",function(e,t,o){var n,r,c;return o.OAuth.initialize("29UtB1-Grz7cpdH4TVjcq0pg8ws"),n=null,r=function(){var t;return t=e.defer(),o.OAuth.popup("google_contact",{cache:!0}).done(function(e){return t.resolve(e)}).fail(function(e){return t.reject(e)}),t.promise},c=function(){var t;return t=e.defer(),n?t.resolve(n):r().then(function(e){return n=e.access_token,t.resolve(n)}),t.promise},{getAll:function(){var o;return o=e.defer(),c().then(function(e){return t.get("https://www.google.com/m8/feeds/contacts/default/full?access_token="+e+"&alt=json&max-results=500").success(function(e){var t;return console.log("data is ",e),e=function(){var o,n,r,c,a,s;for(r=e.feed.entry,s=[],o=0,n=r.length;n>o;o++)t=r[o],(null!=(c=t.gd$phoneNumber)?c.length:0)&&null!=(null!=(a=t.title)?a.$t:void 0)&&s.push({displayName:t.title.$t,selected:!1,telephone:t.gd$phoneNumber[0].$t,telephoneHash:"todo"});return s}(),console.log("data is now",e),o.resolve(e)}).error(function(e){return o.reject(e)})}),o.promise}}}],t.exports=o},{}],22:[function(e,t){var o;o=["$http","config",function(e,t){return{send:function(o){return e({method:"POST",url:""+t.server,data:o})}}}],t.exports=o},{}],23:[function(e,t){var o;o=function(){return{contacts:[],locations:[]}},t.exports=o},{}]},{},[1]);